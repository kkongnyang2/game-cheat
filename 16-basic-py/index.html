
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../15-CE-tutorial/">
      
      
        <link rel="next" href="../17-ow-memory/">
      
      
      <link rel="icon" href="../logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>16 basic py - Game-Cheat</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../soft-era.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="apple" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#py" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Game-Cheat" class="md-header__button md-logo" aria-label="Game-Cheat" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Game-Cheat
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              16 basic py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="apple" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Soft Era"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Soft Era" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20.71 4.63-1.34-1.34c-.37-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.04 0-1.41M7 14a3 3 0 0 0-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.5 2 4 2a4 4 0 0 0 4-4 3 3 0 0 0-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="soft" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Apple Classic"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Apple Classic" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20.71 4.63-1.34-1.34c-.37-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.04 0-1.41M7 14a3 3 0 0 0-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.5 2 4 2a4 4 0 0 0 4-4 3 3 0 0 0-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../1-ow/" class="md-tabs__link">
        
  
  
    
  
  1 ow

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../10-kvmi-v7/" class="md-tabs__link">
        
  
  
    
  
  10 kvmi v7

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../11-xen-drakvuf/" class="md-tabs__link">
        
  
  
    
  
  11 xen drakvuf

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../12-xen-fail/" class="md-tabs__link">
        
  
  
    
  
  12 xen fail

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../13-xen/" class="md-tabs__link">
        
  
  
    
  
  13 xen

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../14-summary/" class="md-tabs__link">
        
  
  
    
  
  14 summary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../15-CE-tutorial/" class="md-tabs__link">
        
  
  
    
  
  15 CE tutorial

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  16 basic py

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../17-ow-memory/" class="md-tabs__link">
        
  
  
    
  
  17 ow memory

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../2-cheats/" class="md-tabs__link">
        
  
  
    
  
  2 cheats

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../3-display/" class="md-tabs__link">
        
  
  
    
  
  3 display

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../4-vmi/" class="md-tabs__link">
        
  
  
    
  
  4 vmi

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../5-igpu/" class="md-tabs__link">
        
  
  
    
  
  5 igpu

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../6-dgpu/" class="md-tabs__link">
        
  
  
    
  
  6 dgpu

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../7-two-gpu/" class="md-tabs__link">
        
  
  
    
  
  7 two gpu

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../8-kvm-legacy/" class="md-tabs__link">
        
  
  
    
  
  8 kvm legacy

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../9-kvmi-v12/" class="md-tabs__link">
        
  
  
    
  
  9 kvmi v12

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../memo/" class="md-tabs__link">
        
  
  
    
  
  Memo

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Game-Cheat" class="md-nav__button md-logo" aria-label="Game-Cheat" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    Game-Cheat
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-ow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 ow
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-kvmi-v7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10 kvmi v7
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-xen-drakvuf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11 xen drakvuf
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-xen-fail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12 xen fail
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-xen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13 xen
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14 summary
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-CE-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15 CE tutorial
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    16 basic py
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    16 basic py
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#py" class="md-nav__link">
    <span class="md-ellipsis">
      베이직 py 코드를 작성해보자
    </span>
  </a>
  
    <nav class="md-nav" aria-label="베이직 py 코드를 작성해보자">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      고정주소 폴링
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      주소 변환 3단계
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      구성요소 기능
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rw" class="md-nav__link">
    <span class="md-ellipsis">
      체인주소 r/w
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-ow-memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    17 ow memory
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-cheats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 cheats
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 display
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-vmi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 vmi
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-igpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 igpu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-dgpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6 dgpu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-two-gpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7 two gpu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-kvm-legacy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8 kvm legacy
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../9-kvmi-v12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9 kvmi v12
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../memo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memo
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#py" class="md-nav__link">
    <span class="md-ellipsis">
      베이직 py 코드를 작성해보자
    </span>
  </a>
  
    <nav class="md-nav" aria-label="베이직 py 코드를 작성해보자">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      고정주소 폴링
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      주소 변환 3단계
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      구성요소 기능
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rw" class="md-nav__link">
    <span class="md-ellipsis">
      체인주소 r/w
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>16 basic py</h1>

<h2 id="py">베이직 py 코드를 작성해보자</h2>
<p>작성자: kkongnyang2 작성일: 2025-08-19</p>
<hr />
<h3 id="_1">고정주소 폴링</h3>
<p>고정주소는 단순하게 고정 가상주소와 그게 어느 프로세스의 가상주소인지만 알려주면 된다.</p>
<p>주소 알아내기<br />
<div class="highlight"><pre><span></span><code>notepad.exe 실행 후 아무 텍스트 적기
텍스트를 변경해가면서 CE에서 주소 확정: 0x21777087720
</code></pre></div></p>
<p>PID 알아내기<br />
<div class="highlight"><pre><span></span><code>$ sudo vmi-process-list win10-seabios | grep -i notepad
[ 11784] notepad.exe (struct addr:ffffd184ad9f1080)
혹은 CE에서 notepad.exe 옆에 뜨는 16진 PID를 echo $((0x2E08)) 해도 됨.
PID=11784
</code></pre></div></p>
<p>코드 작성<br />
<div class="highlight"><pre><span></span><code>$ nano ~/watch_va_poll_wait.py
#!/usr/bin/env python3
import sys, time, signal
from datetime import datetime
from libvmi import Libvmi

def hexdump(b, width=16):
    out=[]
    for i in range(0, len(b), width):
        chunk=b[i:i+width]
        hexs=&#39; &#39;.join(f&#39;{x:02x}&#39; for x in chunk)
        text=&#39;&#39;.join(chr(x) if 32&lt;=x&lt;127 else &#39;.&#39; for x in chunk)
        out.append(f&#39;{i:08x}  {hexs:&lt;{width*3}}  {text}&#39;)
    return &#39;\n&#39;.join(out)

def try_decode(b):
    for enc in (&#39;utf-16le&#39;,&#39;utf-8&#39;,&#39;cp1252&#39;):
        try:
            return enc, b.decode(enc, errors=&#39;strict&#39;)
        except Exception:
            pass
    return None, None

if len(sys.argv) &lt; 5:
    print(&quot;Usage: sudo ~/vmi-venv/bin/python3 watch_va_poll_wait.py &lt;domain&gt; &lt;pid&gt; &lt;vaddr_hex&gt; &lt;length&gt; [interval=0.05]&quot;)
    sys.exit(1)

dom   = sys.argv[1]
pid   = int(sys.argv[2])
vaddr = int(sys.argv[3], 16)
length= int(sys.argv[4])
interval = float(sys.argv[5]) if len(sys.argv)&gt;5 else 0.05

vmi = Libvmi(dom)

stop = {&#39;f&#39;: False}
def bye(sig, frm): stop[&#39;f&#39;] = True
signal.signal(signal.SIGINT, bye)
signal.signal(signal.SIGTERM, bye)

# 1) 메모리에 올라올 때까지 대기 (읽기 성공할 때까지 루프)
print(f&quot;[.] Waiting for page to become resident... (pid={pid}, va=0x{vaddr:x})&quot;)
buf = None
while not stop[&#39;f&#39;]:
    try:
        data, n = vmi.read_va(vaddr, pid, length)
        buf = bytes(data)
        break
    except Exception:
        time.sleep(0.05)

if stop[&#39;f&#39;]:
    vmi.destroy(); sys.exit(0)

enc, text = try_decode(buf)
now = datetime.now().strftime(&#39;%H:%M:%S.%f&#39;)[:-3]
print(f&quot;[{now}] INIT len={len(buf)}&quot;)
if enc and text is not None:
    print(f&quot;  decode({enc}): {repr(text)}&quot;)
print(hexdump(buf))

# 2) 변경 감시
last = buf
while not stop[&#39;f&#39;]:
    try:
        data, n = vmi.read_va(vaddr, pid, length)
        cur = bytes(data)
        if cur != last:
            now = datetime.now().strftime(&#39;%H:%M:%S.%f&#39;)[:-3]
            enc, text = try_decode(cur)
            print(f&quot;[{now}] CHANGE len={len(cur)}&quot;)
            if enc and text is not None:
                print(f&quot;  decode({enc}): {repr(text)}&quot;)
            print(hexdump(cur))
            last = cur
        time.sleep(interval)
    except Exception:
        # 일시적으로 다시 페이징 아웃되면 잠깐 기다렸다 재시도
        time.sleep(0.1)

vmi.destroy()
</code></pre></div><br />
* 대기하다가 해당 페이지가 메모리에 올라온 순간부터 감시하여 변경을 폴링하는 스크립트</p>
<p>실행 커맨드<br />
<div class="highlight"><pre><span></span><code>$ sudo /home/kkongnyang2/vmi-venv/bin/python3 ~/watch_va_poll_wait.py \
  win10-seabios 11784 0x21777087720 64

[.] Waiting for page to become resident... (pid=11784, va=0x21777087720) [18:52:09.471] INIT len=64 decode(utf-16le): &#39;1334#123#1\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08獯ȗ\x00&#39; 00000000 31 00 33 00 33 00 34 00 23 00 31 00 32 00 33 00 1.3.3.4.#.1.2.3. 00000010 23 00 31 00 00 00 00 00 00 00 00 00 00 00 00 00 #.1............. 00000020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 00000030 00 00 00 00 00 00 00 00 08 00 6f 73 17 02 00 00 ..........os.... [18:52:20.162] CHANGE len=64 decode(utf-16le): &#39;1334#123#2\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08獯ȗ\x00&#39; 00000000 31 00 33 00 33 00 34 00 23 00 31 00 32 00 33 00 1.3.3.4.#.1.2.3. 00000010 23 00 32 00 00 00 00 00 00 00 00 00 00 00 00 00 #.2............. 00000020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ 00000030 00 00 00 00 00 00 00 00 08 00 6f 73 17 02 00 00 ..........os....
</code></pre></div></p>
<h3 id="3">주소 변환 3단계</h3>
<p>게스트 가상주소 (GVA, VA)<br />
   └─(게스트 프로세스의 페이지테이블: CR3/DTB)→ 게스트 물리주소 (GPA/PA)<br />
        └─(하이퍼바이저의 2차 변환: EPT/NPT)→ 호스트 물리주소 (HPA, 실제 RAM)</p>
<p>EPROCESS: 커널의 프로세스 객체 구조체<br />
내용물은 PID, ActiveProcessLinks(프로세스 더블링크드 리스트), DTB, Peb(PEB 가상주소)</p>
<p>PEB: 유저 모드에 있는 프로세스 환경 블록<br />
내용물은 ImageBaseAddress(메인 exe의 베이스), Ldr(모듈 리스트로 가는 포인터)</p>
<p>모듈: 프로세스 주소공간에 로드된 메인 EXE + 여러 DLL<br />
PEB-&gt;Ldr-&gt;InMemoryOrderModuleList의 각 노드는 LDR_DATA_TABLE_ENTRY임.</p>
<p>내가 찾는 overwatch2.exe의 베이스라는 건 일반적으로 메인EXE의 베이스.</p>
<p>따라서 베이스 구하는 절차<br />
커널 리스트에서 EPROCESS를 찾고, PEB.Ldr.InMemoryOrderModuleList를 순회하여 각 LDR_DATA_TABLE_ENTRY.DllBase를 수집. 이걸로 각 모듈의 베이스를 알 수 있고 PEB.ImageBaseAddress가 메인 EXE 베이스</p>
<h3 id="_2">구성요소 기능</h3>
<p>libvmi 코어는 C API로 도메인에 attach 하고, PA/VA 읽기쓰기, PID/DTB 기반 번역, 이벤트 등의 기능이 있다. 따라서 원시 메모리를 접근하거나 VA를 PA로 번역하거나 페이지 트랩 등의 저수준 작업이 가능하다.</p>
<p>libvmi 예제는 그 위에 만든 데모로 프로세스 나열, 메모리 덤프, GUID 확인 등의 대표 작업이 가능하다.</p>
<p>python 바인딩은 read_va, write_va를 호출할 수 있다.</p>
<p>프로파일은 구조체나 심볼 오프셋 정보가 들어있어서(EPROCESS/PEB/LDR/UNICODE_STRING/모듈 리스트 등) 이게 있으면 vmi-process-list, PID-&gt;EPROCESS, PEB-&gt;Ldr-&gt;모듈베이스, 문자열 읽기 등 의미를 해석하는 코드를 작동할 수 있다.</p>
<h3 id="rw">체인주소 r/w</h3>
<p>~/game-cheat/code/chain/<br />
 ├─ ist_helpers.py         # IST(JSON)에서 필드 오프셋 얻기 + UNICODE_STRING 읽기<br />
 ├─ vmi_helpers.py         # LibVMI 공통 헬퍼(포인터/정수 읽기·쓰기, wait-present 등)<br />
 ├─ find_module_base.py    # 프로세스에서 모듈 베이스(=ImageBase/DllBase) 찾기<br />
 ├─ walk_chain.py          # 모듈 베이스 + 체인(+오프셋/*역참조) 따라 최종 주소 계산<br />
 └─ rw_value.py            # 최종 주소에서 값 읽기/쓰기 (u32/u64/utf16)</p>
<p>코드 작성<br />
<div class="highlight"><pre><span></span><code>$ nano ~/game-cheat/code/chain/ist_helpers.py
$ nano ~/game-cheat/code/chain/vmi_helpers.py
$ nano ~/game-cheat/code/chain/find_module_base.py
$ nano ~/game-cheat/code/chain/walk_chain.py
$ nano ~/game-cheat/code/chain/rw_value.py
</code></pre></div><br />
* 참고로 ist_helpers.py 에서 [-] 'types' 오류가 떠서<br />
$ sudo python3 - &lt;&lt;'PY'<br />
import json, gzip, lzma<br />
p="/root/symbols/ntkrnlmp.json"<br />
with open(p,'rb') as f:<br />
    sig=f.read(6)<br />
op=open<br />
if sig.startswith(b'\xFD7zXZ\x00'): op=lzma.open<br />
elif sig.startswith(b'\x1F\x8B'): op=gzip.open<br />
with op(p,'rt',encoding='utf-8') as fp:<br />
    d=json.load(fp)<br />
print("top-level keys:", list(d.keys())[:6])<br />
print("has types:", 'types' in d, "has symbols:", 'symbols' in d)<br />
PY<br />
top-level keys: ['base_types', 'enums', 'metadata', 'symbols', 'user_types']<br />
상태를 점검했더니 요즘 volatility3 isf json은 types 대신 user_types를 쓰는 걸 확인. 그래서 널널하게 고쳐줌.<br />
그밖에 인자 개수나 python-libvmi (v3.7.1)엔 어떤 배포본에서는 Libvmi.get_process_by_pid(...) 같은 편의 래퍼가 포함되지 않는 문제 등을 하드코딩 해줌.</p>
<p>실행 커맨드<br />
<div class="highlight"><pre><span></span><code>$ sudo vmi-process-list win10-seabios | grep -i notepad
[ 4692] notepad.exe (struct addr:ffff9d0697c21080)
$ sudo /home/kkongnyang2/vmi-venv/bin/python3 ~/game-cheat/code/chain/find_module_base.py \
  win10-seabios 4692 Notepad.exe /root/symbols/ntkrnlmp.json
VMI_WARNING: Invalid offset name in windows_get_offset (win_peb).
0x00007ff7dc6e0000

$ sudo vmi-process-list win10-seabios | grep -i tutorial
[10220] Tutorial-x86_6 (struct addr:ffff9d068d194300)
$ sudo /home/kkongnyang2/vmi-venv/bin/python3 ~/game-cheat/code/chain/find_module_base.py   win10-seabios 10220 Tutorial-x86_64.exe /root/symbols/ntkrnlmp.json
VMI_WARNING: Invalid offset name in windows_get_offset (win_peb).
0x0000000100000000
</code></pre></div><br />
* 참고로 vmi-process-list는 15바이트까지만 돼서 모듈명 뒤 이름은 짤림. 알아서 적어주기.</p>
<p>실행 커맨드2<br />
<div class="highlight"><pre><span></span><code>$ sudo /home/kkongnyang2/vmi-venv/bin/python3 ~/game-cheat/code/chain/walk_chain.py   win10-seabios 10220 Tutorial-x86_64.exe /root/symbols/ntkrnlmp.json &quot;+0x34ECA0 * +0x10 * +0x18 * +0x0 * +0x18&quot; 64
[+] base=Tutorial-x86_64.exe@0x0000000100000000
[+] final address = 0x0000000001587108
00000000  e6 0b 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00000010  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00000020  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
00000030  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................
</code></pre></div><br />
* 64는 그 주소에서 몇 바이트를 덤프해서 보여줄지를 뜻하는 len임.</p>
<p>실행 커맨드3<br />
<div class="highlight"><pre><span></span><code># 읽기 (u32)
$ sudo /home/kkongnyang2/vmi-venv/bin/python3 ~/game-cheat/code/chain/rw_value.py \
  win10-seabios 10220 Tutorial-x86_64.exe /root/symbols/ntkrnlmp.json &quot;+0x34ECA0 * +0x10 * +0x18 * +0x0 * +0x18&quot; --read --type u32
[+] final address: 0x0000000001587108
u32 = 3046 (0x00000be6)

# 쓰기 (u32)
$ sudo /home/kkongnyang2/vmi-venv/bin/python3 ~/game-cheat/code/chain/rw_value.py \
  win10-seabios 10220 Tutorial-x86_64.exe /root/symbols/ntkrnlmp.json &quot;+0x34ECA0 * +0x10 * +0x18 * +0x0 * +0x18&quot; --write --type u32 --value 1337
[+] final address: 0x0000000001587108
[OK] wrote u32 1337 at 0x0000000001587108
</code></pre></div><br />
* u32는 4bytes로 값 읽기<br />
* 문자열(UTF-16LE)로 쓰기를 하고 싶다면 --write --type utf16 --text "KKN!" 해주면 됨</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.copy", "header.autohide"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>