
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../17-dump/">
      
      
        <link rel="next" href="../19-memory/">
      
      
      <link rel="icon" href="../logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>18 write watch - Game-Cheat</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../soft-era.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="apple" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Game-Cheat" class="md-header__button md-logo" aria-label="Game-Cheat" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Game-Cheat
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              18 write watch
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="apple" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Soft Era"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Soft Era" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20.71 4.63-1.34-1.34c-.37-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.04 0-1.41M7 14a3 3 0 0 0-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.5 2 4 2a4 4 0 0 0 4-4 3 3 0 0 0-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="soft" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Apple Classic"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Apple Classic" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20.71 4.63-1.34-1.34c-.37-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.04 0-1.41M7 14a3 3 0 0 0-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.5 2 4 2a4 4 0 0 0 4-4 3 3 0 0 0-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../1-ow/" class="md-tabs__link">
        
  
  
    
  
  1 ow

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../10-kvmi-v7/" class="md-tabs__link">
        
  
  
    
  
  10 kvmi v7

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../11-xen-22.04/" class="md-tabs__link">
        
  
  
    
  
  11 xen 22.04

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../12-xen-backlist/" class="md-tabs__link">
        
  
  
    
  
  12 xen backlist

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../13-xen-pciback/" class="md-tabs__link">
        
  
  
    
  
  13 xen pciback

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../14-summary/" class="md-tabs__link">
        
  
  
    
  
  14 summary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../15-CE-tutorial/" class="md-tabs__link">
        
  
  
    
  
  15 CE tutorial

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../16-vmi-rw/" class="md-tabs__link">
        
  
  
    
  
  16 vmi rw

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../17-dump/" class="md-tabs__link">
        
  
  
    
  
  17 dump

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  18 write watch

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../19-memory/" class="md-tabs__link">
        
  
  
    
  
  19 memory

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../2-cheats/" class="md-tabs__link">
        
  
  
    
  
  2 cheats

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../20-main/" class="md-tabs__link">
        
  
  
    
  
  20 main

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../3-display/" class="md-tabs__link">
        
  
  
    
  
  3 display

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../4-igpu/" class="md-tabs__link">
        
  
  
    
  
  4 igpu

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../5-dgpu/" class="md-tabs__link">
        
  
  
    
  
  5 dgpu

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../6-two-gpu/" class="md-tabs__link">
        
  
  
    
  
  6 two gpu

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../7-vmi/" class="md-tabs__link">
        
  
  
    
  
  7 vmi

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../8-kvm-legacy/" class="md-tabs__link">
        
  
  
    
  
  8 kvm legacy

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../9-kvmi-v12/" class="md-tabs__link">
        
  
  
    
  
  9 kvmi v12

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../memo/" class="md-tabs__link">
        
  
  
    
  
  Memo

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Game-Cheat" class="md-nav__button md-logo" aria-label="Game-Cheat" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    Game-Cheat
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-ow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1 ow
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-kvmi-v7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10 kvmi v7
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-xen-22.04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11 xen 22.04
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-xen-backlist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12 xen backlist
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-xen-pciback/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13 xen pciback
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-summary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14 summary
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../15-CE-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15 CE tutorial
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../16-vmi-rw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    16 vmi rw
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../17-dump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    17 dump
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    18 write watch
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    18 write watch
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      실시간 할당 후보군을 관찰해보자
    </span>
  </a>
  
    <nav class="md-nav" aria-label="실시간 할당 후보군을 관찰해보자">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xen" class="md-nav__link">
    <span class="md-ellipsis">
      xen 페이지 잡기
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drakvuf" class="md-nav__link">
    <span class="md-ellipsis">
      drakvuf 설치
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drakvuf_1" class="md-nav__link">
    <span class="md-ellipsis">
      drakvuf 커스텀 플러그인 제작
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watch_data_ranges" class="md-nav__link">
    <span class="md-ellipsis">
      watch_data_ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      잡기 실패
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../19-memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    19 memory
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-cheats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2 cheats
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../20-main/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    20 main
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3 display
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-igpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4 igpu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-dgpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5 dgpu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-two-gpu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6 two gpu
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-vmi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7 vmi
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-kvm-legacy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8 kvm legacy
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../9-kvmi-v12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9 kvmi v12
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../memo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memo
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      실시간 할당 후보군을 관찰해보자
    </span>
  </a>
  
    <nav class="md-nav" aria-label="실시간 할당 후보군을 관찰해보자">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xen" class="md-nav__link">
    <span class="md-ellipsis">
      xen 페이지 잡기
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drakvuf" class="md-nav__link">
    <span class="md-ellipsis">
      drakvuf 설치
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drakvuf_1" class="md-nav__link">
    <span class="md-ellipsis">
      drakvuf 커스텀 플러그인 제작
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#watch_data_ranges" class="md-nav__link">
    <span class="md-ellipsis">
      watch_data_ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      잡기 실패
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>18 write watch</h1>

<h2 id="_1">실시간 할당 후보군을 관찰해보자</h2>
<p>작성자: kkongnyang2 작성일: 2025-09-16</p>
<hr />
<h3 id="xen">xen 페이지 잡기</h3>
<p>게스트 코드  ──(HP 갱신)──► [가상주소 GVA] → 페이지 테이블 → [게스트물리 GPA]<br />
                                           │<br />
                              하이퍼바이저의 2단 변환(EPT/NPT)<br />
                                           ↓<br />
             EPT 권한 비트(R/W/X)로 페이지를 의도적으로 막아둠<br />
                                           ↓<br />
                 접근 발생 → EPT violation → VM-exit(호스트로)<br />
                                           ↓<br />
   VM-exit 정보: 접근종류(R/W/X), GLA(선택적), GPA, RIP, CR3(DTB) 등<br />
                                           ↓<br />
  분석기(예: LibVMI/Drakvuf)가 RIP 주변 명령 디코드 → 쓰기 크기/대상 파악<br />
                                           ↓<br />
            (옵션) 일시 허용+단일 스텝 후 재보호(re-arm)로 계속 추적</p>
<p>실시간 vmi 환경에서 할당되는 페이지를 훅킹해 VM-exit 트랩으로 감시</p>
<h3 id="drakvuf">drakvuf 설치</h3>
<p>drakvuf 설치<br />
<div class="highlight"><pre><span></span><code>ubuntu on xen으로 들어가서
$ sudo apt install meson ninja-build clang llvm lld libglib2.0-dev libjson-c-dev
$ git clone --recursive https://github.com/tklengyel/drakvuf
$ cd drakvuf
$ meson setup build --native-file llvm.ini
$ ninja -C build
$ sudo ninja -C build install
$ sudo ldconfig
</code></pre></div></p>
<p>기능 확인<br />
<div class="highlight"><pre><span></span><code>$ sudo xl list        # 몇번인지 확인
$ sudo drakvuf -r /root/symbols/ntkrnlmp.json -d 1 -a procmon
</code></pre></div></p>
<h3 id="drakvuf_1">drakvuf 커스텀 플러그인 제작</h3>
<p>데이터를 서버에서 받아오면 ntdll.dll이 비어있는 주소에 힙 할당을 하고 그 주소를 리턴해준다. 그러면 overwatch.exe는 그걸 테이블에 저장해뒀다가 필요할때마다 찾아가서 read &amp; write를 해준다. </p>
<p>그럼 이 할당을 어떻게 잡아올 수 있냐?<br />
윈도우 내부에서는 커널의 할당 함수들을 쫒는다. vmi 환경에서는 특정 구역들에 vm-exit 걸어놓아 거기에 write하려하면 무조건 예외처리로 확인된다. 이 방식이 drakvuf에 구현되어 있다.</p>
<p>drakvuf의 syscall + memaccess를 이용해 drakvuf 커스텀 플러그인으로 해주자.<br />
1. syscalls 후킹: NtAllocateVirtualMemory, NtMapViewOfsection<br />
2. 리턴 성공 시 *BaseAddress, *RegionSize 읽어서 [base,size) 구간 확보<br />
3. VA 필터 : (base..base+size)가 0x 0000 0200 0000 0000 ~ 0x 0000 02FF FFFF FFFF와 교차하면 대상 처리<br />
4. 페이지별 W-트랩 등록: 해당 구간을 4KB 페이지로 쪼개 memaccess 등록<br />
5. memaccess 콜백: (pid, tid, rip, gva, gfn)로깅 -&gt; 싱글스텝 1회 허용 -&gt; 다시 W 금지<br />
6. free/unmap 시 : 추적 테이블에서 트랩 해제</p>
<p>다만 처음에 이 방법으로 시도했다가, 힙 할당된 va에 값이 변화하는게 CE에서 보임에도 여기서는 va write를 못잡아옴. 일반 read에서는 읽어오는 걸 보면 프로세스가 아닌 커널 측에서 해당 gpa에 write 하는 걸로 추정. 즉 결과 write는 읽을 수 있지만 실시간 망에는 포착되지 않는다는 뜻. va를 gpa로 번역한 후 write를 잡아오도록 고친다.</p>
<p>drakvuf/<br />
└─ src/<br />
   └─ plugins/<br />
      ├─ meson.build              ← 여기에 한 줄 추가<br />
      └─ pfn_writewatch/<br />
         ├─ pfn_writewatch.cpp ← 새로 추가<br />
         └─ pfn_writewatch.h   ← 새로 추가</p>
<p>커스텀 플러그인 제작<br />
<div class="highlight"><pre><span></span><code>$ cd ~/drakvuf/src/plugins
$ mkdir pfn_writewatch
$ nano pfn_writewatch/pfn_writewatch.h
$ nano pfn_writewatch/pfn_writewatch.cpp
$ nano meson.build
plugin_sources = [
  # (기존들)
  &#39;pfn_writewatch/pfn_writewatch.cpp&#39;,
  &#39;pfn_writewatch/pfn_writewatch.h&#39;,
]
$ nano plugins.h
플러그인 리스트 drakvuf_plugin_t 의 마지막 __DRAKVUF_PLUGIN_LIST_MAX 앞줄에
    PLUGIN_PFN_WRITEWATCH,
이름 리스트 static const char* drakvuf_plugin_names[] 에
    [PLUGIN_PFN_WRITEWATCH] = &quot;pfn_writewatch&quot;,
os 지원 리스트 drakvuf_plugin_os_support 에
    [PLUGIN_PFN_WRITEWATCH] = { [VMI_OS_WINDOWS] = 1, [VMI_OS_LINUX] = 1 },
$ nano plugins.cpp
#include &quot;pfn_writewatch/pfn_writewatch.h&quot;
drakvuf_plugins::start 안의 큰 switch에 case 추가
case PLUGIN_PFN_WRITEWATCH:
{
    this-&gt;plugins[plugin_id] = std::make_unique&lt;pfn_writewatch&gt;(this-&gt;drakvuf, this-&gt;output);
    break;
}
</code></pre></div></p>
<p>재빌드<br />
<div class="highlight"><pre><span></span><code>$ cd ~/drakvuf
$ meson setup build --reconfigure
$ ninja -C build
$ sudo ninja -C build install
$ sudo ldconfig
</code></pre></div></p>
<h3 id="watch_data_ranges">watch_data_ranges</h3>
<p>실시간으로 .data 섹션을 덤프하여 heap 포인터로 추정되는 candidate를 전부 찾고 상위 클러스터 범위 다섯개를 추려 아까 만든 drakvuf 플러그인으로 감시하는 코드<br />
.data 덤프 + candidate 찾기 + 상위 클러스터 만들기 + pfn 번역 + writewatch + 내용 및 델타 바이터 확인</p>
<p>실행 커맨드<br />
<div class="highlight"><pre><span></span><code>$ sudo vmi-process-list win10 | grep -i overwatch
$ cd ~/game-cheat/code
$ sudo /home/kkongnyang2/vmi-venv/bin/python3 -m dump.watch_data_ranges \
  --domain win10 --pid 2900 --module Overwatch.exe \
  --ist-json /root/symbols/ntkrnlmp.json \
  --python /home/kkongnyang2/vmi-venv/bin/python3 \
  --dumper-module dump.vmi_dump_section \
  --project-root ~/game-cheat/code \
  --drakvuf /usr/local/bin/drakvuf \
  --watch pfn \
  --mode cluster --topk 5 --gran-log2 22 --gap-pages 64 --pad 0x10000 \
  --duration 10 --interval 5 \
  --ww-mode both --peek-bytes 16 --max-changes 12 \
  --outdir /home/kkongnyang2/watch_dump --max-pfns 2048

=== CYCLE 1 ===
[dump] running: /home/kkongnyang2/vmi-venv/bin/python3 -m dump.vmi_dump_section win10 10068 Overwatch.exe /root/symbols/ntkrnlmp.json .data
[dumped] Overwatch.exe_.data_0x7ff7af882000_0x2ef800.bin  (size=3078144/3078144)
Invalid offset name in windows_get_offset (win_peb).

[info] data dump: /home/kkongnyang2/watch_dump/dumps/Overwatch.exe_.data_0x7ff7af882000_0x2ef800.bin
[info] heap-like candidates: 1097
[range 1/13] VA 0x1ffffff0000-0x20000091000 (size=644 KB)
[range 2/13] VA 0x20f19070000-0x20f190b2000 (size=264 KB)
[range 3/13] VA 0x20f191b0000-0x20f191d3000 (size=140 KB)
[range 4/13] VA 0x20f192b0000-0x20f1938d000 (size=884 KB)
[range 5/13] VA 0x20f20fd6000-0x20f21055000 (size=508 KB)
[range 6/13] VA 0x20f210b8000-0x20f210dc000 (size=144 KB)
[range 7/13] VA 0x20f21123000-0x20f21145000 (size=136 KB)
[range 8/13] VA 0x20f2117a000-0x20f211dc000 (size=392 KB)
[range 9/13] VA 0x20f211fd000-0x20f2121e000 (size=132 KB)
[range 10/13] VA 0x20f21248000-0x20f21269000 (size=132 KB)
[range 11/13] VA 0x20f2132f000-0x20f21350000 (size=132 KB)
[range 12/13] VA 0x20f213ca000-0x20f213f4000 (size=168 KB)
[range 13/13] VA 0x20f3b7f0000-0x20f3b81d000 (size=180 KB)
[warn] VA window 0x1ffffff0000-0x20000091000 produced no PFNs; skipping
[info] VA→PFN: 35 PFNs from window 0x20f19070000-0x20f190b2000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_35pfns_20250916T035457Z.jsonl (PFNs=35, max_events=5000, max_bytes=8000000)
[writewatch] timeout reached; terminating
[writewatch] END events≈0, bytes=112, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_35pfns_20250916T035457Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_35pfns_20250916T035457Z.jsonl (events≈0)
[info] VA→PFN: 20 PFNs from window 0x20f191b0000-0x20f191d3000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_20pfns_20250916T035508Z.jsonl (PFNs=20, max_events=5000, max_bytes=8000000)
[writewatch] timeout reached; terminating
[writewatch] END events≈2779, bytes=302303, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_20pfns_20250916T035508Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_20pfns_20250916T035508Z.jsonl (events≈2779)
[info] VA→PFN: 206 PFNs from window 0x20f192b0000-0x20f1938d000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_206pfns_20250916T035518Z.jsonl (PFNs=206, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=545111); terminating
[writewatch] END events≈5000, bytes=545111, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_206pfns_20250916T035518Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_206pfns_20250916T035518Z.jsonl (events≈5000)
[info] VA→PFN: 117 PFNs from window 0x20f20fd6000-0x20f21055000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_117pfns_20250916T035518Z.jsonl (PFNs=117, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=545109); terminating
[writewatch] END events≈5000, bytes=545109, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_117pfns_20250916T035518Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_117pfns_20250916T035518Z.jsonl (events≈5000)
[info] VA→PFN: 35 PFNs from window 0x20f210b8000-0x20f210dc000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_35pfns_20250916T035519Z.jsonl (PFNs=35, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=544934); terminating
[writewatch] END events≈5000, bytes=544934, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_35pfns_20250916T035519Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_35pfns_20250916T035519Z.jsonl (events≈5000)
[info] VA→PFN: 34 PFNs from window 0x20f21123000-0x20f21145000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_34pfns_20250916T035519Z.jsonl (PFNs=34, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=543016); terminating
[writewatch] END events≈5000, bytes=543016, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_34pfns_20250916T035519Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_34pfns_20250916T035519Z.jsonl (events≈5000)
[info] VA→PFN: 95 PFNs from window 0x20f2117a000-0x20f211dc000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_95pfns_20250916T035521Z.jsonl (PFNs=95, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=541629); terminating
[writewatch] END events≈5000, bytes=541629, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_95pfns_20250916T035521Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_95pfns_20250916T035521Z.jsonl (events≈5000)
[info] VA→PFN: 33 PFNs from window 0x20f211fd000-0x20f2121e000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035521Z.jsonl (PFNs=33, max_events=5000, max_bytes=8000000)
[writewatch] timeout reached; terminating
[writewatch] END events≈0, bytes=112, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035521Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035521Z.jsonl (events≈0)
[info] VA→PFN: 33 PFNs from window 0x20f21248000-0x20f21269000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035532Z.jsonl (PFNs=33, max_events=5000, max_bytes=8000000)
[writewatch] timeout reached; terminating
[writewatch] END events≈0, bytes=112, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035532Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035532Z.jsonl (events≈0)
[info] VA→PFN: 33 PFNs from window 0x20f2132f000-0x20f21350000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035542Z.jsonl (PFNs=33, max_events=5000, max_bytes=8000000)
[writewatch] timeout reached; terminating
[writewatch] END events≈4957, bytes=540425, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035542Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_33pfns_20250916T035542Z.jsonl (events≈4957)
[info] VA→PFN: 42 PFNs from window 0x20f213ca000-0x20f213f4000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_42pfns_20250916T035552Z.jsonl (PFNs=42, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=545112); terminating
[writewatch] END events≈5000, bytes=545112, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_42pfns_20250916T035552Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_42pfns_20250916T035552Z.jsonl (events≈5000)
[info] VA→PFN: 29 PFNs from window 0x20f3b7f0000-0x20f3b81d000
[writewatch/PFN] START /usr/local/bin/drakvuf -r /root/symbols/ntkrnlmp.json -d 4 -a pfn_writewatch -o json → /home/kkongnyang2/watch_dump/logs/pfnwatch_29pfns_20250916T035553Z.jsonl (PFNs=29, max_events=5000, max_bytes=8000000)
[writewatch] storm guard hit (events=5000, bytes=545076); terminating
[writewatch] END events≈5000, bytes=545076, file=/home/kkongnyang2/watch_dump/logs/pfnwatch_29pfns_20250916T035553Z.jsonl
[saved] /home/kkongnyang2/watch_dump/logs/pfnwatch_29pfns_20250916T035553Z.jsonl (events≈5000)
[sleep] 5s ...
</code></pre></div></p>
<h3 id="_2">잡기 실패</h3>
<p>약간 범위가 빗나감. 난독화 때문에 .data에 있는 포인터들이 부정확 하거나, 힙에 포인터가 있는 거 같음.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.copy", "header.autohide"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>